\subsection{Code}

\subsubsection{Vector Database API}\label{appendix:vector-db-api}

\begin{verbatim}
let question = "How many ..";

// Initialize vector database and embedding model
let vector = Vector::infer();
let model = EmbeddingModel::from_env().expect("failed to load embedding model");

// Load schema distance index for the target database
let index: DistanceIndex = DistanceIndexRow::get("test_db", &vector)?.into();

// Embed the question and run the multi-dimensional selection algorithm
let selector = Selector::new(question.as_ref(), None, &model)?;
let samples = selection::<8>(&selector, &index, &vector)?;
\end{verbatim}

\paragraph{Vector Database Schema}\label{appendix:vector-schema}

\begin{verbatim}
CREATE TABLE IF NOT EXISTS databases (
  id               text not null,
  name             text not null,
  graph            text not null
);

CREATE TABLE IF NOT EXISTS distance_indices (
  db_id            text not null,
  distances        text not null
);

CREATE VIRTUAL TABLE IF NOT EXISTS samples USING vec0 (
  id                 text not null,
  db_id              text not null,

  question           text not null,
  question_embedding float[4096],

  sql                text not null,
  sql_embedding      float[4096]
);
\end{verbatim}

\paragraph{Benchmark Traits}\label{appendix:benchmark-traits}

\begin{verbatim}
pub trait Benchmark {
    type Error: From<eyre::Report> + Debug;
    type Database: BenchmarkDatabase<Error = Self::Error>;

    fn name() -> &'static str;

    fn databases(&self) -> impl Iterator<Item = &Self::Database>;
    fn database(&self, id: impl AsRef<str>) -> Option<&Self::Database>;

    fn tests(&self) -> impl Iterator<
      Item = &<Self::Database as BenchmarkDatabase>::Test
    >;

    fn test(&self, id: impl AsRef<str>) -> Option<
      &<Self::Database as BenchmarkDatabase>::Test
    >;
}

pub trait BenchmarkDatabase {
    type Error: From<eyre::Report> + Debug;
    type Test: BenchmarkTest;

    fn id(&self) -> &str;
    fn connect(&self) -> Result<Database, Self::Error>;
    fn tests(&self) -> impl Iterator<Item = &Self::Test>;
    fn test(&self, id: impl AsRef<str>) -> Option<&Self::Test>;
}

pub trait BenchmarkTest {
    fn id(&self) -> &str;
    fn db_id(&self) -> &str;

    fn name(&self) -> &str;
    fn question(&self) -> &str;
    fn query(&self) -> &str;
}
\end{verbatim}
